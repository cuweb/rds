import{r as u,R as C}from"./index-580b8df0.js";import{S as q,D as W,y as j,T as ce,s as le,o as S,c as de,u as N,d as K,X as U,C as ue,l as ve}from"./open-closed-2007ab4d.js";import{f as z,L as fe,I as A,c as Y,p as Z,O as L,M as R,h as Pe,T as me,o as G,r as ae,e as be,N as _}from"./keyboard-7b7aa261.js";import{s as Se}from"./use-resolve-button-type-acf5cd20.js";import{n as ee,E as ye,a as se,s as D}from"./use-event-listener-4e982338.js";var Ee=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ee||{}),ge=(e=>(e[e.TogglePopover=0]="TogglePopover",e[e.ClosePopover=1]="ClosePopover",e[e.SetButton=2]="SetButton",e[e.SetButtonId=3]="SetButtonId",e[e.SetPanel=4]="SetPanel",e[e.SetPanelId=5]="SetPanelId",e))(ge||{});let Ie={[0]:e=>({...e,popoverState:N(e.popoverState,{[0]:1,[1]:0})}),[1](e){return e.popoverState===1?e:{...e,popoverState:1}},[2](e,l){return e.button===l.button?e:{...e,button:l.button}},[3](e,l){return e.buttonId===l.buttonId?e:{...e,buttonId:l.buttonId}},[4](e,l){return e.panel===l.panel?e:{...e,panel:l.panel}},[5](e,l){return e.panelId===l.panelId?e:{...e,panelId:l.panelId}}},te=u.createContext(null);te.displayName="PopoverContext";function J(e){let l=u.useContext(te);if(l===null){let P=new Error(`<${e} /> is missing a parent <Popover /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(P,J),P}return l}let ne=u.createContext(null);ne.displayName="PopoverAPIContext";function re(e){let l=u.useContext(ne);if(l===null){let P=new Error(`<${e} /> is missing a parent <Popover /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(P,re),P}return l}let oe=u.createContext(null);oe.displayName="PopoverGroupContext";function ie(){return u.useContext(oe)}let Q=u.createContext(null);Q.displayName="PopoverPanelContext";function $e(){return u.useContext(Q)}function he(e,l){return N(l.type,Ie,e,l)}let xe="div";function Ce(e,l){var P;let y=u.useRef(null),$=j(l,ce(t=>{y.current=t})),o=u.useRef([]),n=u.useReducer(he,{popoverState:1,buttons:o,button:null,buttonId:null,panel:null,panelId:null,beforePanelSentinel:u.createRef(),afterPanelSentinel:u.createRef()}),[{popoverState:v,button:s,buttonId:h,panel:m,panelId:E,beforePanelSentinel:i,afterPanelSentinel:k},d]=n,c=ee((P=y.current)!=null?P:s),b=u.useMemo(()=>{if(!s||!m)return!1;for(let X of document.querySelectorAll("body > *"))if(Number(X==null?void 0:X.contains(s))^Number(X==null?void 0:X.contains(m)))return!0;let t=z(),a=t.indexOf(s),x=(a+t.length-1)%t.length,M=(a+1)%t.length,V=t[x],pe=t[M];return!m.contains(V)&&!m.contains(pe)},[s,m]),g=le(h),w=le(E),T=u.useMemo(()=>({buttonId:g,panelId:w,close:()=>d({type:1})}),[g,w,d]),O=ie(),B=O==null?void 0:O.registerPopover,H=S(()=>{var t;return(t=O==null?void 0:O.isFocusWithinPopoverGroup())!=null?t:(c==null?void 0:c.activeElement)&&((s==null?void 0:s.contains(c.activeElement))||(m==null?void 0:m.contains(c.activeElement)))});u.useEffect(()=>B==null?void 0:B(T),[B,T]),ye(c==null?void 0:c.defaultView,"focus",t=>{var a,x,M,V;v===0&&(H()||s&&m&&t.target!==window&&((x=(a=i.current)==null?void 0:a.contains)!=null&&x.call(a,t.target)||(V=(M=k.current)==null?void 0:M.contains)!=null&&V.call(M,t.target)||d({type:1})))},!0),fe([s,m],(t,a)=>{d({type:1}),Pe(a,me.Loose)||(t.preventDefault(),s==null||s.focus())},v===0);let p=S(t=>{d({type:1});let a=(()=>t?t instanceof HTMLElement?t:"current"in t&&t.current instanceof HTMLElement?t.current:s:s)();a==null||a.focus()}),I=u.useMemo(()=>({close:p,isPortalled:b}),[p,b]),f=u.useMemo(()=>({open:v===0,close:p}),[v,p]),F=e,r={ref:$};return C.createElement(Q.Provider,{value:null},C.createElement(te.Provider,{value:n},C.createElement(ne.Provider,{value:I},C.createElement(de,{value:N(v,{[0]:K.Open,[1]:K.Closed})},U({ourProps:r,theirProps:F,slot:f,defaultTag:xe,name:"Popover"})))))}let Te="button";function Fe(e,l){let P=A(),{id:y=`headlessui-popover-button-${P}`,...$}=e,[o,n]=J("Popover.Button"),{isPortalled:v}=re("Popover.Button"),s=u.useRef(null),h=`headlessui-focus-sentinel-${A()}`,m=ie(),E=m==null?void 0:m.closeOthers,i=$e()!==null;u.useEffect(()=>{if(!i)return n({type:3,buttonId:y}),()=>{n({type:3,buttonId:null})}},[i,y,n]);let[k]=u.useState(()=>Symbol()),d=j(s,l,i?null:r=>{if(r)o.buttons.current.push(k);else{let t=o.buttons.current.indexOf(k);t!==-1&&o.buttons.current.splice(t,1)}o.buttons.current.length>1&&console.warn("You are already using a <Popover.Button /> but only 1 <Popover.Button /> is supported."),r&&n({type:2,button:r})}),c=j(s,l),b=ee(s),g=S(r=>{var t,a,x;if(i){if(o.popoverState===1)return;switch(r.key){case G.Space:case G.Enter:r.preventDefault(),(a=(t=r.target).click)==null||a.call(t),n({type:1}),(x=o.button)==null||x.focus();break}}else switch(r.key){case G.Space:case G.Enter:r.preventDefault(),r.stopPropagation(),o.popoverState===1&&(E==null||E(o.buttonId)),n({type:0});break;case G.Escape:if(o.popoverState!==0)return E==null?void 0:E(o.buttonId);if(!s.current||b!=null&&b.activeElement&&!s.current.contains(b.activeElement))return;r.preventDefault(),r.stopPropagation(),n({type:1});break}}),w=S(r=>{i||r.key===G.Space&&r.preventDefault()}),T=S(r=>{var t,a;ae(r.currentTarget)||e.disabled||(i?(n({type:1}),(t=o.button)==null||t.focus()):(r.preventDefault(),r.stopPropagation(),o.popoverState===1&&(E==null||E(o.buttonId)),n({type:0}),(a=o.button)==null||a.focus()))}),O=S(r=>{r.preventDefault(),r.stopPropagation()}),B=o.popoverState===0,H=u.useMemo(()=>({open:B}),[B]),p=Se(e,s),I=i?{ref:c,type:p,onKeyDown:g,onClick:T}:{ref:d,id:o.buttonId,type:p,"aria-expanded":e.disabled?void 0:o.popoverState===0,"aria-controls":o.panel?o.panelId:void 0,onKeyDown:g,onKeyUp:w,onClick:T,onMouseDown:O},f=se(),F=S(()=>{let r=o.panel;if(!r)return;function t(){N(f.current,{[D.Forwards]:()=>L(r,R.First),[D.Backwards]:()=>L(r,R.Last)})===_.Error&&L(z().filter(a=>a.dataset.headlessuiFocusGuard!=="true"),N(f.current,{[D.Forwards]:R.Next,[D.Backwards]:R.Previous}),{relativeTo:o.button})}t()});return C.createElement(C.Fragment,null,U({ourProps:I,theirProps:$,slot:H,defaultTag:Te,name:"Popover.Button"}),B&&!i&&v&&C.createElement(Y,{id:h,features:Z.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:F}))}let we="div",Oe=q.RenderStrategy|q.Static;function Be(e,l){let P=A(),{id:y=`headlessui-popover-overlay-${P}`,...$}=e,[{popoverState:o},n]=J("Popover.Overlay"),v=j(l),s=ue(),h=(()=>s!==null?(s&K.Open)===K.Open:o===0)(),m=S(i=>{if(ae(i.currentTarget))return i.preventDefault();n({type:1})}),E=u.useMemo(()=>({open:o===0}),[o]);return U({ourProps:{ref:v,id:y,"aria-hidden":!0,onClick:m},theirProps:$,slot:E,defaultTag:we,features:Oe,visible:h,name:"Popover.Overlay"})}let ke="div",Me=q.RenderStrategy|q.Static;function Re(e,l){let P=A(),{id:y=`headlessui-popover-panel-${P}`,focus:$=!1,...o}=e,[n,v]=J("Popover.Panel"),{close:s,isPortalled:h}=re("Popover.Panel"),m=`headlessui-focus-sentinel-before-${A()}`,E=`headlessui-focus-sentinel-after-${A()}`,i=u.useRef(null),k=j(i,l,p=>{v({type:4,panel:p})}),d=ee(i);ve(()=>(v({type:5,panelId:y}),()=>{v({type:5,panelId:null})}),[y,v]);let c=ue(),b=(()=>c!==null?(c&K.Open)===K.Open:n.popoverState===0)(),g=S(p=>{var I;switch(p.key){case G.Escape:if(n.popoverState!==0||!i.current||d!=null&&d.activeElement&&!i.current.contains(d.activeElement))return;p.preventDefault(),p.stopPropagation(),v({type:1}),(I=n.button)==null||I.focus();break}});u.useEffect(()=>{var p;e.static||n.popoverState===1&&((p=e.unmount)==null||p)&&v({type:4,panel:null})},[n.popoverState,e.unmount,e.static,v]),u.useEffect(()=>{if(!$||n.popoverState!==0||!i.current)return;let p=d==null?void 0:d.activeElement;i.current.contains(p)||L(i.current,R.First)},[$,i,n.popoverState]);let w=u.useMemo(()=>({open:n.popoverState===0,close:s}),[n,s]),T={ref:k,id:y,onKeyDown:g,onBlur:$&&n.popoverState===0?p=>{var I,f,F,r,t;let a=p.relatedTarget;a&&i.current&&((I=i.current)!=null&&I.contains(a)||(v({type:1}),((F=(f=n.beforePanelSentinel.current)==null?void 0:f.contains)!=null&&F.call(f,a)||(t=(r=n.afterPanelSentinel.current)==null?void 0:r.contains)!=null&&t.call(r,a))&&a.focus({preventScroll:!0})))}:void 0,tabIndex:-1},O=se(),B=S(()=>{let p=i.current;if(!p)return;function I(){N(O.current,{[D.Forwards]:()=>{var f;L(p,R.First)===_.Error&&((f=n.afterPanelSentinel.current)==null||f.focus())},[D.Backwards]:()=>{var f;(f=n.button)==null||f.focus({preventScroll:!0})}})}I()}),H=S(()=>{let p=i.current;if(!p)return;function I(){N(O.current,{[D.Forwards]:()=>{var f;if(!n.button)return;let F=z(),r=F.indexOf(n.button),t=F.slice(0,r+1),a=[...F.slice(r+1),...t];for(let x of a.slice())if(x.dataset.headlessuiFocusGuard==="true"||(f=n.panel)!=null&&f.contains(x)){let M=a.indexOf(x);M!==-1&&a.splice(M,1)}L(a,R.First,{sorted:!1})},[D.Backwards]:()=>{var f;L(p,R.Previous)===_.Error&&((f=n.button)==null||f.focus())}})}I()});return C.createElement(Q.Provider,{value:y},b&&h&&C.createElement(Y,{id:m,ref:n.beforePanelSentinel,features:Z.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:B}),U({ourProps:T,theirProps:o,slot:w,defaultTag:ke,features:Me,visible:b,name:"Popover.Panel"}),b&&h&&C.createElement(Y,{id:E,ref:n.afterPanelSentinel,features:Z.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:H}))}let De="div";function Ge(e,l){let P=u.useRef(null),y=j(P,l),[$,o]=u.useState([]),n=S(d=>{o(c=>{let b=c.indexOf(d);if(b!==-1){let g=c.slice();return g.splice(b,1),g}return c})}),v=S(d=>(o(c=>[...c,d]),()=>n(d))),s=S(()=>{var d;let c=be(P);if(!c)return!1;let b=c.activeElement;return(d=P.current)!=null&&d.contains(b)?!0:$.some(g=>{var w,T;return((w=c.getElementById(g.buttonId.current))==null?void 0:w.contains(b))||((T=c.getElementById(g.panelId.current))==null?void 0:T.contains(b))})}),h=S(d=>{for(let c of $)c.buttonId.current!==d&&c.close()}),m=u.useMemo(()=>({registerPopover:v,unregisterPopover:n,isFocusWithinPopoverGroup:s,closeOthers:h}),[v,n,s,h]),E=u.useMemo(()=>({}),[]),i=e,k={ref:y};return C.createElement(oe.Provider,{value:m},U({ourProps:k,theirProps:i,slot:E,defaultTag:De,name:"Popover.Group"}))}let Le=W(Ce),Ne=W(Fe),Ae=W(Be),je=W(Re),Ke=W(Ge),qe=Object.assign(Le,{Button:Ne,Overlay:Ae,Panel:je,Group:Ke});export{qe as L};
//# sourceMappingURL=popover-3492950b.js.map
